# AccessString

## 编写StringDemo.java

```java
class StringDemo{
	private native String getLine(String prompt);
	public static void main(String args[]){
		StringDemo p = new StringDemo();
		String input = p.getLine("Type a line: ");
		System.out.println("User typed: " + input);
	}

	static {
		System.loadLibrary("StringDemo");
	}
}
```

## 执行命令 javac

```basic
javac StringDemo.java
```

生成文件 StringDemo.class

## 执行命令javah

```basic
javah StringDemo
```

生成StringDemo.h

```c
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class StringDemo */

#ifndef _Included_StringDemo
#define _Included_StringDemo
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     StringDemo
 * Method:    getLine
 * Signature: (Ljava/lang/String;)Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_StringDemo_getLine
  (JNIEnv *, jobject, jstring);

#ifdef __cplusplus
}
#endif
#endif
```

## 编写StringDemo.c

```c
#include <jni.h>
#include <stdio.h>
#include "StringDemo.h"
JNIEXPORT jstring JNICALL
Java_StringDemo_getLine(JNIEnv *env, jobject obj, jstring stringdemo){
	char buf[128];
	const jbyte *str;
	str = (*env)->GetStringUTFChars(env, stringdemo, NULL);
	if (str == NULL)
		return NULL;
	printf("%s", str);
	(*env)->ReleaseStringUTFChars(env, stringdemo, str);
	
	scanf("%127s", buf);
	return (*env)->NewStringUTF(env, buf);
}

```

## 执行命令gcc

```basic
gcc -shared -fpic -I/usr/lib/jvm/java-1.8.0-openjdk-amd64/include/linux -I/usr/lib/lib/jvm/java-1.8.0-openjdk-amd64/include StringDemo.c -o libStringDemo.so
```

## 运行

```basic
java Djava.library.path=. StringDemo
```

